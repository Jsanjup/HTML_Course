<html>

<head>
    <title>Caja registradora</title>
</head>

<body>
    <h1>CAJA REGISTRADORA</h1>


    <h2>Productos</h2>
    <table id="vitrina"></table>
    <br>
    <p>
        ------------------------------------
    </p>
    <br>
    <h2>Tu Carro</h2>
    <table id="carrito"></table>
    <form name="carro">
        <h4>Producto</h4>
        <select name="productos" id="productos">
            <option value="zanahorias">Zanahorias</option>
            <option value="patatas">Patatas</option>
            <option value="manzanas">Manzanas</option>
            <option value="lechugas">Lechugas</option>
            <option value="naranjas">Naranjas</option>
        </select>
        <h4>Cantidad</h4>
        <input type="number" name="cantidad" value="0" size="2">
        <input type="button" name="" value="Lo quiero" onclick="addToCart()">

    </form>
    <br>
    <br>
    <br>
    <br>
    <br>
    <p>
        ------------------------------------
    </p>
    <br>
    <form name="calc">
        <h3>Total a Pagar</h3>
        <input type="number" name="total" value="0" size="4" disabled>
        <br>
        <h3>Pago</h3>
        <input type="number" name="pagado" value="0" size="4">
        <input type="button" name="" value="Pagar" onclick="paga()">
        <br>
        <h3> Cambio</h3>
        <input type="text" name="cambio" value="0" size="4" disabled>
        <br>
        <br>

    </form>

    <script type="text/javascript">
        const productos = {
            "zanahorias": { precio: 2, stock: 20 },
            "patatas": { precio: 1, stock: 120 },
            "manzanas": { precio: 3, stock: 40 },
            "lechugas": { precio: 4, stock: 5 },
            "naranjas": { precio: 5, stock: 15 },
        };

        const carrito = {};

        function addToCart() {
            let selectedItem = document.carro.productos.value;
            let cantidad =parseInt(document.carro.cantidad.value);

            let producto = productos[selectedItem];

            if (producto.stock < cantidad) {
                alert(`No hay suficiente stock. Solo quedan ${producto.stock} unidades.`)
            } else {
                producto.stock -= cantidad;
                let total = 0;
                total = parseInt(document.calc.total.value);
                total += cantidad * producto.precio;
                document.calc.total.value = total;
                let prev = carrito[selectedItem] || {};
                carrito[selectedItem] = { stock: (prev?.stock || 0) + cantidad, precio: (prev?.precio || 0) + cantidad * producto.precio };
                rellenaVitrina();
                carritoActual();
            }
        }

        function paga() {
            let total = document.calc.total.value;
            let pagado = document.calc.pagado.value;

            if (pagado > total) {
                document.calc.cambio.value = pagado - total;
                carrito = {}
            } else {
                alert("Falta Dinero...");
            }
        }

        function rellenaVitrina() {
            let htmlTable = "<tr><th>Producto</th><th>Stock</th><th>Precio</th></tr>";
            for (let p of Object.keys(productos)) {
                htmlTable += `<tr><td>${p}</td><td>${productos[p].stock}</td><td>${productos[p].precio}</td></tr>`;
            }
            let vitrina = document.getElementById("vitrina");
            vitrina.innerHTML = htmlTable;
        }

        function carritoActual() {
            if (Object.keys(carrito).length > 0) {
                let htmlTable = "<tr><th>Producto</th><th>Cantidad</th><th>Precio</th></tr>";
                for (let p of Object.keys(carrito)) {
                    htmlTable += `<tr><td>${p}</td><td>${carrito[p].stock}</td><td>${carrito[p].precio}</td></tr>`;
                }
                let vistaCarrito = document.getElementById("carrito");
                vistaCarrito.innerHTML = htmlTable;
            }
        }

        rellenaVitrina();
        carritoActual();
    </script>
</body>

</html>