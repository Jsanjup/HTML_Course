<html>

<head>
    <title>Caja registradora</title>
</head>

<body>
    <h1>CAJA REGISTRADORA</h1>


    <h2>Productos</h2>
    <table id="vitrina"></table>
    <br>
    <p>
        ------------------------------------
    </p>
    <br>
    <h2>Tu Carro</h2>
    <table id="carrito"></table>
    <form name="carro">
        <h4>Producto</h4>
        <select name="productos" id="productos">
            <option value="zanahorias">Zanahorias</option>
            <option value="patatas">Patatas</option>
            <option value="manzanas">Manzanas</option>
            <option value="lechugas">Lechugas</option>
            <option value="naranjas">Naranjas</option>
        </select>
        <h4>Cantidad</h4>
        <input type="number" name="cantidad" value="0" size="2">
        <input type="button" name="" value="Lo quiero" onclick="addToCart()">

    </form>
    <br>
    <br>
    <br>
    <br>
    <br>
    <p>
        ------------------------------------
    </p>
    <br>
    <form name="calc">
        <h3>Total a Pagar</h3>
        <input type="number" name="total" value="0" size="4" disabled>
        <br>
        <h3>Pago</h3>
        <input type="number" name="pagado" value="0" size="4">
        <input type="button" name="" value="Pagar" onclick="paga()">
        <br>
        <h3> Cambio</h3>
        <input type="text" name="cambio" value="0" size="4" disabled>
        <br>
        <br>

    </form>

    <script type="text/javascript">
        const productos = {
            "zanahorias": { precio: 2, stock: 20 },
            "patatas": { precio: 1, stock: 120 },
            "manzanas": { precio: 3, stock: 40 },
            "lechugas": { precio: 4, stock: 5 },
            "naranjas": { precio: 5, stock: 15 },
        };

        let carrito = {};

        function addToCart() {
            let seleccionado = document.carro.productos.value;
            let cantidad = parseInt(document.carro.cantidad.value);

            let estado = productos[seleccionado];
            if (estado.stock >= cantidad) {
                estado.stock = estado.stock - cantidad;
                document.calc.total.value = parseInt(document.calc.total.value) + cantidad * estado.precio;

                if (carrito[seleccionado]){
                    let previo = carrito[seleccionado];
                    carrito[seleccionado] = { precio: previo.precio + cantidad * estado.precio , stock: previo.stock + cantidad};
                } else {
                    carrito[seleccionado] = { precio: cantidad * estado.precio, stock: cantidad };
                }
                rellenaVitrina();
                carritoActual();
            } else {
                alert(`Solo quedan ${estado.stock} ${seleccionado}`)
            }

        }

        function paga() {
            let total = parseInt(document.calc.total.value);
            let pagado = parseInt(document.calc.pagado.value);

            if (pagado < total) {
                alert("Falta dinero. Moroso de mierda.")
            } else {
                document.calc.cambio.value = pagado - total;
                carrito = {};
                carritoActual();
                console.log(carrito)
            }
        }

        function rellenaVitrina() {
            let htmlTable = "<tr><th>Producto</th><th>Stock</th><th>Precio</th></tr>";
            for (let p of Object.keys(productos)) {
                htmlTable += `<tr><td>${p}</td><td>${productos[p].stock}</td><td>${productos[p].precio}</td></tr>`;
            }
            let vitrina = document.getElementById("vitrina");
            vitrina.innerHTML = htmlTable;
        }

        function carritoActual() {
            let htmlTable = "";
            if (Object.keys(carrito).length > 0) {
                htmlTable += "<tr><th>Producto</th><th>Cantidad</th><th>Coste</th></tr>";
                for (let p of Object.keys(carrito)) {
                    htmlTable += `<tr><td>${p}</td><td>${carrito[p].stock}</td><td>${carrito[p].precio}</td></tr>`;
                }
            }
            let vistaCarrito = document.getElementById("carrito");
            vistaCarrito.innerHTML = htmlTable;
        }

        rellenaVitrina();
        carritoActual();
    </script>
</body>

</html>